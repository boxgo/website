(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{368:function(s,a,e){"use strict";e.r(a);var t=e(45),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"为什么封装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为什么封装"}},[s._v("#")]),s._v(" 为什么封装？")]),s._v(" "),e("p",[s._v("在开源盛行的今天，我们没有必要也“几乎”不可能造所有的轮子。\n开源界有很多优秀的项目可供挑选，使用开源项目可以极大地降低开发成本、快速地提升开发效率，但天下没有免费的午餐，使用开源项目的同时也带来很多问题：")]),s._v(" "),e("ol",[e("li",[s._v("用法差异大、用法复杂，无法快速上手")]),s._v(" "),e("li",[s._v("错误处理、日志输出、指标上报、配置加载支持程度不同")]),s._v(" "),e("li",[s._v("功能集合过大，如不加约束的使用，无法统一用法")]),s._v(" "),e("li",[s._v("质量参差不齐，如不加约束的引用，类库的缺陷就会不受限的在组织内传导，修复的成本非常高")]),s._v(" "),e("li",[s._v("未遵守版本规范，到底用哪个版本？")]),s._v(" "),e("li",[s._v("相同功能多个项目，到底选哪个？")]),s._v(" "),e("li",[s._v("直接使用，替换成本高")])]),s._v(" "),e("h2",{attrs:{id:"怎么封装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#怎么封装"}},[s._v("#")]),s._v(" 怎么封装？")]),s._v(" "),e("p",[s._v("因此对于引入的常用的、重要的开源类库，我们需进行统一封装，尽量减少直接引用开源软件。封装规范如下:")]),s._v(" "),e("ol",[e("li",[s._v("实现配置注册、动静态加载")]),s._v(" "),e("li",[s._v("实现工厂方法，通过 "),e("code",[s._v("Config")]),s._v(" 构建实例，而不是直接 "),e("code",[s._v("New")]),s._v(" 创建实例")]),s._v(" "),e("li",[s._v("实现配置动静态加载、指标上报、链路跟踪、统一日志，统一错误等功能")]),s._v(" "),e("li",[s._v("启停功能通过 "),e("code",[s._v("Serve")]),s._v("，"),e("code",[s._v("Shutdown")]),s._v(" 实现，统一由 box application 管理")]),s._v(" "),e("li",[s._v("重要的 type 起别名，避免使用时再 import 开源项目\n"),e("ol",[e("li",[e("code",[s._v("type alias: type T = package_xx.T1")])])])]),s._v(" "),e("li",[s._v("重要的 const、var，func 做绑定，避免使用时再 import 开源项目\n"),e("ol",[e("li",[e("code",[s._v("var ErrClosed = package_xx.ErrClosed")])]),s._v(" "),e("li",[e("code",[s._v("const Nil = redis.Nil")])]),s._v(" "),e("li",[e("code",[s._v("var Func = package_xx.Func")])])])]),s._v(" "),e("li",[s._v("至少提供一个 Test 和 Example")]),s._v(" "),e("li",[s._v("避免使用 "),e("code",[s._v("type embedding")]),s._v(" ，虽然方便，但将暴露过多细节")])]),s._v(" "),e("h2",{attrs:{id:"example"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[s._v("#")]),s._v(" Example")]),s._v(" "),e("p",[s._v("源代码见 "),e("a",{attrs:{href:"https://github.com/boxgo/box/tree/next/pkg/client/redis",target:"_blank",rel:"noopener noreferrer"}},[s._v("pkg/client/redis"),e("OutboundLink")],1),s._v(" 。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" tree pkg/client/redis\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" pkg/client/redis\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ├── alias.go\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ├── config.go\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ├── default.go\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ├── metric.go\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ├── redis.go\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ├── redis_test.go\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ├── script.go\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" └── testdata\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     ├── ci.yaml\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     └── local.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);